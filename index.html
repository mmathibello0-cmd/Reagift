<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Our Magical Memory üíõ</title>

<style>
body{
    margin:0;
    height:100vh;
    background:
        linear-gradient(135deg,#000000cc,#00000099),
        url("https://i.imgur.com/Rmd9Ns1.jpeg");
    background-size:cover;
    background-position:center;
    color:white;
    font-family:"Trebuchet MS",Arial,sans-serif;
    text-align:center;
    overflow:hidden;
}

.center{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
}

h1,h2{
    text-shadow:0 0 10px gold;
}

input,button{
    padding:12px 18px;
    font-size:18px;
    border-radius:10px;
    border:none;
}

button{
    background:linear-gradient(45deg,gold,orange);
    box-shadow:0 0 12px gold;
    cursor:pointer;
    color:black;
}

/* Screens */
.screen{display:none;} 
.active{display:block}

/* Puzzle */
#puzzle{
    width:300px;
    height:300px;
    margin:auto;
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:4px;
}

.piece{
    background:url("https://i.imgur.com/KQsyAZ2.jpeg");
    background-size:300px 300px;
    border-radius:8px;
    cursor:pointer;
    transition:transform .15s;
}

.piece:hover{ transform:scale(1.03); }

.empty{background:none}

/* Blueprint Effect */
#blueprintReveal{
    display:none;
    width:300px;
    height:300px;
    margin:auto;
    position:relative;
}

#blueprint{
    position:absolute;
    inset:0;
    background:#0c2447;
    background-image:
        linear-gradient(#ffffff22 1px, transparent 1px),
        linear-gradient(90deg,#ffffff22 1px, transparent 1px);
    background-size:20px 20px;
    animation:fade 4s forwards;
}

#colorReveal{
    position:absolute;
    inset:0;
    background:url("https://i.imgur.com/KQsyAZ2.jpeg") center/cover;
    animation:draw 4s forwards;
}

@keyframes draw{
    from{filter:grayscale(100%) brightness(40%);clip-path:inset(100% 0 0 0);}
    to{filter:none;clip-path:inset(0);}
}

@keyframes fade{ to{opacity:0} }

/* Magical Memory Text */
#memoryText{
    margin-top:18px;
    font-size:22px;
    color:gold;
    text-shadow:
      0 0 5px gold,
      0 0 12px orange,
      0 0 22px gold;
    animation:
      memoryFade 3s ease forwards,
      float 3s ease-in-out infinite alternate;
}

@keyframes memoryFade{
    from{opacity:0; transform:translateY(20px);}
    to{opacity:1; transform:translateY(0);}
}

@keyframes float{
    from{transform:translateY(0);}
    to{transform:translateY(-10px);}
}

/* Floating Sunflowers */
.sunflower{
    position:absolute;
    width:36px;
    height:36px;
    background:url("https://i.imgur.com/O9B0gXN.png") center/contain no-repeat;
    animation:floatUp linear infinite;
}

@keyframes floatUp{
    from{transform:translateY(110vh) rotate(0deg);}
    to{transform:translateY(-120px) rotate(360deg);}
}

/* Love Letter Screen */
#letterScreen{
    position:absolute;
    inset:0;
    background:#000000eb;
    display:none;
}

#typing{
    font-size:20px;
    line-height:1.6;
    max-width:70vw;
    white-space:pre-wrap;
    margin:auto;
    text-shadow:0 0 8px gold;
}

/* Replay Ending */
#replayScreen{
    position:absolute;
    inset:0;
    background:#000000ee;
    display:none;
}

.heart{
    width:140px;
    height:140px;
    background:red;
    transform:rotate(45deg);
    margin:80px auto 0 auto;
    position:relative;
    animation:pulse 1.8s infinite;
    box-shadow:0 0 30px #ff4d4d;
}

.heart::before, .heart::after{
    content:"";
    width:140px;
    height:140px;
    background:red;
    position:absolute;
    border-radius:50%;
}

.heart::before{ top:-70px; left:0; }
.heart::after{ left:-70px; top:0; }

@keyframes pulse{
    0%{transform:rotate(45deg) scale(1);}
    50%{transform:rotate(45deg) scale(1.2);}
    100%{transform:rotate(45deg) scale(1);}
}

.glow-text{
    margin-top:40px;
    font-size:22px;
    color:gold;
    text-shadow:0 0 10px gold,0 0 20px orange;
}
</style>
</head>

<body>

<!-- Login Screen -->
<div id="login" class="screen active center">
    <h1>üîê Enter the Portal</h1>
    <input id="pass" type="password" placeholder="Password">
    <br><br>
    <button onclick="check()">UNLOCK ‚ù§Ô∏è</button>
</div>

<!-- Puzzle & Memory Screen -->
<div id="game" class="screen center">
    <h2>üß© Build the Memory</h2>
    <div id="puzzle"></div>

    <div id="blueprintReveal">
        <div id="blueprint"></div>
        <div id="colorReveal"></div>
    </div>

    <p id="memoryText"></p>
</div>

<!-- Love Letter Screen -->
<div id="letterScreen">
    <div class="center">
        <h1>üíõ My Love Letter üíõ</h1>
        <p id="typing"></p>
        <br><br>
        <button onclick="replay()">üîÅ Tap to Replay Memory</button>
    </div>
</div>

<!-- Replay Heart Screen -->
<div id="replayScreen">
    <div class="heart"></div>
    <div class="glow-text">üíõ To more smiles shared üíõ</div>
</div>

<script>
const PASSWORD="Pumpkin200925";

/* ‚úîÔ∏è REAL LOVE LETTER TEXT */
const loveMessage = `Hey my love,
We are officially 10 days away from your birthday, which also marks 3 months since I met you ‚Äî my favorite person.
Thank you for being such a loving and caring spirit in my life. You showed me that good still exists in this world.
As a future civil engineer, you are literally learning how to BUILD the world‚Ä¶ but I hope you know you've already built something priceless inside my heart.
Never stop shining. Never stop smiling. You are destined for great things.
I can't wait to watch you grow into your best self.
Me and you until we go into the ground. üíõ
Remember: No weapon formed against you will prosper.`;

const memoryLine="‚ú® üíõ I am glad I didn't get into the taxi üíõ ‚ú®";

function check(){
    if(pass.value===PASSWORD){
        login.style.display="none";
        game.classList.add("active");
        start();
        suns();
    } else{
        alert("Wrong password üò≠");
    }
}

/* Puzzle */
const puzzle=document.getElementById("puzzle"); 
let pos=[];

function start(){
    pos=[...Array(9).keys()];
    shuffle(pos);
    draw();
}

function draw(){
    puzzle.innerHTML="";
    pos.forEach((p,i)=>{
        let d=document.createElement("div");
        d.className="piece";
        if(p===8){ d.classList.add("empty"); } 
        else{
            let x=(p%3)*100;
            let y=Math.floor(p/3)*100;
            d.style.backgroundPosition=`-${x}px -${y}px`;
        }
        d.onclick=()=>move(i);
        puzzle.appendChild(d);
    });
    checkWin();
}

// Updated move function: allow horizontal, vertical, and diagonal moves
function move(i){
    let e = pos.indexOf(8);
    let eRow = Math.floor(e/3), eCol = e%3;
    let iRow = Math.floor(i/3), iCol = i%3;

    // Move allowed if the clicked piece is a neighbor of the empty spot (including diagonal)
    if(Math.abs(eRow - iRow) <= 1 && Math.abs(eCol - iCol) <= 1 && i !== e){
        [pos[i], pos[e]] = [pos[e], pos[i]];
        draw();
    }
}

function checkWin(){
    for(let i=0;i<9;i++){
        if(pos[i]!==i) return;
    }
    finish();
}

/* Finish Puzzle ‚Üí Blueprint ‚Üí Memory ‚Üí Letter */
function finish(){
    puzzle.style.display="none";
    blueprintReveal.style.display="block";
    memoryText.textContent=memoryLine;
    setTimeout(showLetter,4200);
}

/* Letter typing */
let t=0;
function showLetter(){
    game.style.display="none";
    letterScreen.style.display="block";
    typing.textContent=""; // clear previous text
    t=0;                  // reset index
    type();
}

function type(){
    if(t<loveMessage.length){
        typing.textContent+=loveMessage[t];
        t++;
        setTimeout(type,35);
    }
}

/* Replay */
function replay(){
    letterScreen.style.display="none";
    replayScreen.style.display="block";
}

/* Sunflowers */
function suns(){
    for(let i=0;i<10;i++){
        let s=document.createElement("div");
        s.className="sunflower";
        s.style.left=Math.random()*90+"vw";
        s.style.animationDuration=(5+Math.random()*5)+"s";
        document.body.appendChild(s);
    }
}

/* Shuffle helper */
function shuffle(a){
    for(let i=a.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
    }
}
</script>

</body>
</html>
